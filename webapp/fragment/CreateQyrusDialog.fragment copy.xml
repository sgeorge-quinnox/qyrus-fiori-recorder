<!-- webapp/fragments/CreateQyrusDialog.fragment.xml -->
<core:FragmentDefinition xmlns="sap.m"
  xmlns:core="sap.ui.core"
  xmlns:form="sap.ui.layout.form">

  <Dialog id="createQyrusDialog"
          title="Create Test in Qyrus"
          stretchOnPhone="true"
          contentHeight="auto"
          contentWidth="42rem"
          class="sapUiMediumPadding">

    <content>
      <form:SimpleForm id="qyrusForm"
                       editable="true"
                       layout="ResponsiveGridLayout"
                       labelSpanXL="3" labelSpanL="3" labelSpanM="4" labelSpanS="12"
                       adjustLabelSpan="false"
                       emptySpanXL="0" emptySpanL="0" emptySpanM="0" emptySpanS="0"
                       columnsXL="2" columnsL="2" columnsM="1" singleContainerFullSize="false">

        <!-- Execution options: side-by-side -->
        <!-- <Label text="Execution Options"/> -->
        <VBox>
          <HBox justifyContent="SpaceBetween" alignItems="Center">
            <HBox width="100%" alignItems="Center">
              <Label text="Inject UI5 + OPA5 helpers" />
              <Switch state="{qyrusForm>/injectHelpers}" />
            </HBox>
            <HBox width="100%" alignItems="Center">
              <Label text="Add Wait before each action" />
              <Switch state="{qyrusForm>/waitEach}" />
            </HBox>
          </HBox>

          <!-- Session / Launch -->
          <!-- Timing: Timeout + Poll side-by-side -->
          <!-- <Label text="Timing"/> -->
          <HBox alignItems="Center" justifyContent="SpaceBetween">
            <HBox width="100%" class="sapUiTinyMarginEnd" alignItems="Center">
              <Label text="Timeout (ms)" class="sapUiTinyMarginEnd"/>
              <StepInput min="5" max="600" step="5" value="{qyrusForm>/timeout}" width="10rem" />
            </HBox>
            <HBox width="100%" alignItems="Center">
              <Label text="Poll every (ms)" class="sapUiTinyMarginEnd"/>
              <StepInput min="5" max="600" step="5" value="{qyrusForm>/poll}" width="10rem" />
            </HBox>
          </HBox>

          <!-- <Label text="Launch"/> -->
          <HBox alignItems="Center" justifyContent="SpaceBetween">
            <HBox width="100%" class="sapUiTinyMarginEnd" alignItems="Center">
              <CheckBox
                  text="Add Launch URL"
                  selected="{qyrusForm>/optLaunch}"
              />
              <Input
                  value="{qyrusForm>/launchUrl}"
                  placeholder="https://…"
                  enabled="{= ${qyrusForm>/optLaunch} }"
                  width="100%"
              />
            </HBox>
            <HBox width="100%" alignItems="Center">
              <CheckBox
                  text="Add wait after launch (sec)"
                  selected="{qyrusForm>/optWaitAfterLaunch}"
              />
              <StepInput
                  min="0" max="6000" step="5"
                  value="{qyrusForm>/waitAfterLaunch}"
                  enabled="{= ${qyrusForm>/optWaitAfterLaunch} }"
                  width="100%"
              />
            </HBox>
          </HBox>
          

          <!-- <Label text="Wait After Launch"/> -->
          

          <!-- Add Login step (toggles the nested login fields) -->
          <!-- <Label text="Login"/> -->
          <HBox alignItems="Center">
            <CheckBox
              text="Add Login step"
              selected="{qyrusForm>/optLogin}"
              class="sapUiTinyMarginEnd"
            />

            <!-- Nested login fields; only visible if optLogin is true -->
            <!-- <Label text="Credentials" /> -->
            <HBox visible="{= ${qyrusForm>/optLogin} }" alignItems="Center" justifyContent="SpaceBetween">
              <HBox width="100%" class="sapUiTinyMarginEnd" alignItems="Center">
                <Label text="User" class="sapUiTinyMarginEnd"/>
                <Input value="{qyrusForm>/loginUser}" width="100%"/>
              </HBox>
              <HBox width="100%" alignItems="Center">
                <Label text="Password" class="sapUiTinyMarginEnd"/>
                <Input type="Password" value="{qyrusForm>/loginPass}" width="100%"/>
              </HBox>
            </HBox>
          </HBox>

          <!-- Add wait after login (sec) + numeric input (gated by optLogin & checkbox) -->
          <!-- <Label text="Post-login Wait"/> -->
          <HBox visible="{= ${qyrusForm>/optLogin} }" width="100%">
            <CheckBox
                text="Add wait after login (sec)"
                selected="{qyrusForm>/optWaitAfterLogin}"
                 class="sapUiTinyMarginEnd"
            />
            <StepInput
                min="0" max="6000" step="5"
                value="{qyrusForm>/waitAfterLogin}"
                enabled="{= ${qyrusForm>/optWaitAfterLogin} }"
                width="10rem"
            />
          </HBox>

          <Button type="Emphasized" text="Convert" press=".onConvertOpa5" />

          <!-- OPA5 Input / Convert / Output JSON -->
          <!-- <Title text="OPA5 Input" level="H3"/>
          <TextArea rows="4" width="100%" value="{qyrusForm>/opa5Input}" placeholder="Paste OPA5 code here…" />

          <Title text="Output JSON" level="H3"/>
          <TextArea rows="4" width="100%" value="{qyrusForm>/outJson}" /> -->


          <!-- Teams and Service Store -->
          <HBox alignItems="Center" justifyContent="SpaceBetween" gap="1rem">
            
            <!-- Teams -->
            <HBox width="100%" class="sapUiTinyMarginEnd" alignItems="Center" flex="1">
              <Label text="Teams" class="sapUiTinyMarginEnd"/>
              <VBox width="100%" flex="1">
                <Select id="teamSelect"
                        width="100%"
                        selectedKey="{qyrusForm>/teams/selectedId}"
                        change=".onTeamChanged"
                        items="{ path: 'qyrusForm>/teams/list' }">
                  <core:Item key="{qyrusForm>id}" text="{qyrusForm>name}" />
                </Select>
              </VBox>
            </HBox>

            <!-- Service Stores -->
            <HBox width="100%" alignItems="Center" flex="1">
              <Label text="Service Stores" class="sapUiTinyMarginEnd"/>
              <VBox width="100%" flex="1">
                <Select id="serviceStoreSelect"
                        width="100%"
                        selectedKey="{qyrusForm>/serviceStores/selectedId}"
                        change=".onServiceStoreChanged"
                        items="{ path: 'qyrusForm>/serviceStores/list' }">
                  <core:Item key="{qyrusForm>id}" text="{qyrusForm>name}" />
                </Select>
              </VBox>
            </HBox>

          </HBox>


          <HBox alignItems="Center" justifyContent="SpaceBetween" gap="1rem">
            <!-- Project -->
            <HBox alignItems="Center" class="sapUiTinyMarginEnd" width="100%" flex="1">
              <Label text="Project" class="sapUiTinyMarginEnd"/>
              <VBox width="100%" flex="1">
                <Select id="projectSelect"
                        width="100%"
                        selectedKey="{qyrusForm>/projects/selectedId}"
                        change=".onProjectChanged"
                        items="{ path: 'qyrusForm>/projects/list' }">
                  <core:Item key="{qyrusForm>id}" text="{qyrusForm>name}" />
                </Select>
              </VBox>
            </HBox>

            <!-- Module -->
            <HBox alignItems="Center" width="100%" flex="1">
              <Label text="Module" class="sapUiTinyMarginEnd"/>
              <VBox width="100%" flex="1">
                <Select id="moduleSelect"
                        width="100%"
                        selectedKey="{qyrusForm>/modules/selectedId}"
                        items="{ path: 'qyrusForm>/modules/list' }">
                  <core:Item key="{qyrusForm>id}" text="{qyrusForm>name}" />
                </Select>
              </VBox>
            </HBox>
          </HBox>

          
          <HBox alignItems="Center" justifyContent="SpaceBetween">
            <HBox width="100%" class="sapUiTinyMarginEnd" alignItems="Center">
              <!-- Test meta -->
              <Label text="Test Name" class="sapUiTinyMarginEnd"/>
              <Input value="{qyrusForm>/testName}" width="100%" />
            </HBox>
            <HBox width="100%" alignItems="Center">
              <Label text="Test Description" class="sapUiTinyMarginEnd"/>
              <Input value="{qyrusForm>/testDescription}" width="100%" />
            </HBox>
          </HBox>

          <Label text="Test Objective"/>
          <TextArea rows="3" width="100%" value="{qyrusForm>/testObjective}" />
        </VBox>
      </form:SimpleForm>
    </content>

    <!-- 3 buttons as requested -->
    <buttons class="sapUiSmallPadding">
      <Button text="Create Headers" type="Transparent" press=".onCreateHeaders" />
      <Button text="Create Test" type="Emphasized" press=".onCreateTest" />
      <Button text="Cancel" type="Transparent" press=".onCancelCreateQyrus" />
    </buttons>
  </Dialog>
</core:FragmentDefinition>
